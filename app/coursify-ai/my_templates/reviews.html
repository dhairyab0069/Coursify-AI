
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviews</title>
    <!--icons-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylereview.css') }}">
</head>
<body>
    <!--header design-->
    <header class="header">
        <div class="link_container">
            <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='cap_logo1.png') }}" id="logo"></a>
        </div>
        <div class="link_container">
            <nav class="navbar">
                <div id="sidebar"></div>
                <a href="{{ url_for('index') }}" id="home">HOME</a>
                <a href="{{ url_for('my_content') }}" id="content">MY CONTENT</a>
                <a href="ai.html" id="ai">AI ASSISTANT</a>
                <a href="{{ url_for('reviews') }}">REVIEW</a>
                <a href="settings.html" id="settings">SETTINGS</a>
                <a href="{{ url_for('logout') }}" id="logout">LOGOUT</a>
            </nav>
        </div>
    </header>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div id="flash">
        {{ messages[0] }}
      </div>
    {% endif %}
  {% endwith %}  

    <main class="main-content">
        <div class="grid-container">
            <div class="user-based-accuracy-score">    
                <h2>Ratings & Reviews</h2>
                <div class="average-score">
                    <span class="score-value">4.9</span>
                    <span class="out-of">out of 5</span>
                </div>
                <div class="ratings-bars">
                    <div class="bar-container">
                        <span class="star-label">5 stars: <span class="star-count" id="star-5-count"></span></span>
                        <div class="bar five-star"></div>
                    </div>
                    <div class="bar-container">
                        <span class="star-label">4 stars : <span class="star-count" id="star-4-count"></span></span>
                        <div class="bar four-star"></div>
                    </div>
                    <div class="bar-container">
                        <span class="star-label">3 stars : <span class="star-count" id="star-3-count"></span></span>
                        <div class="bar three-star"></div>
                    </div>
                    <div class="bar-container">
                        <span class="star-label">2 stars : <span class="star-count" id="star-2-count"></span></span>
                        <div class="bar two-star"></div>
                    </div>
                    <div class="bar-container">
                        <span class="star-label">1 star : <span class="star-count" id="star-1-count"></span></span>
                        <div class="bar one-star"></div>
                    </div>
                </div>
                <div class="total-ratings">
                    <span>9,167,770 Ratings</span>
                    <a href="#" class="see-all">See All</a>
                </div>
            </div>
            
            <!-- Add Review Section -->
            <form class="add-review" method="POST" action="/submit_review">
                <h3>Add Your Review</h3>
                <div class="stars">
                    <!-- Clickable stars for rating -->
                    <i class="bx bxs-star" data-value="1"></i>
                    <i class="bx bxs-star" data-value="2"></i>
                    <i class="bx bxs-star" data-value="3"></i>
                    <i class="bx bxs-star" data-value="4"></i>
                    <i class="bx bxs-star" data-value="5"></i>
                </div>
                <select name="subject" id="subject_list" placeholder="Subject">
                    <option value="choose">Choose Subject</option> <!-- Dropdown list for subject -->
                    <option value="Math">Math</option>
                    <option value="Geography">Geography</option>
                    <option value="History">History</option>
                    <option value="Biology">Biology</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Physics">Physics</option>
                    <option value="English">English</option>
                    <option value="Economics">Economics</option>
                    <option value="Computer Science">Computer Science</option>
                    <option value="Business">Business</option>
                    <option value="Other">Other</option>
                </select>
                <textarea name="review_text" placeholder="Write your review here..."></textarea>
                <input type="hidden" name="star_rating" id="star_rating" value=""> <!-- Hidden field to store rating -->
                <button type="submit">Submit Review</button>
            </form>

            <!-- Reviews Section -->
            <div class="reviews-container">
                <div class="reviews-filter-container">
                    <select class="reviews-filter" name="rating" id="rating" onchange="filterReviews()">
                        <option value="">Filter by rating</option>
                        <option value="5">5 star</option>
                        <option value="4">4 star</option>
                        <option value="3">3 star</option>
                        <option value="2">2 star</option>
                        <option value="1">1 star</option>
                    </select>
                    <select class="reviews-filter" name="subject" id="subject" onchange="filterReviews()">
                        <option value="">Filter by subject</option>
                        <option value="Math">Math</option>
                        <option value="Geography">Geography</option>
                        <option value="History">History</option>
                        <option value="Biology">Biology</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Physics">Physics</option>
                        <option value="English">English</option>
                        <option value="Economics">Economics</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Business">Business</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            
                <!-- Individual reviews will go here -->
                {% for review in reviews %}
                <div class="review" data-rating="{{ review.star_rating }}" data-subject="{{ review.subject }}">
                    <div class="review-rating">Rating: {{ review.star_rating }} / 5</div>
                    <div class="review-subject">Subject: {{ review.subject }}</div>
                    <div class="review-text">{{ review.review_text }}</div>
                </div>
                {% else %}
                <div>No reviews yet.</div>
                {% endfor %}
            </div>
    </main>

    <script>

 document.addEventListener('DOMContentLoaded', function () {
    const stars = document.querySelectorAll('.bx.bxs-star');
    const ratingInput = document.getElementById('star_rating');
    const subjectInput = document.getElementById('subject');


    window.onload = function() {
    fetch('/ratings')
        .then(response => response.json())
        .then(data => {
            // Update average rating
            document.querySelector('.average-score .score-value').textContent = data.average_rating.toFixed(1);

            // Update star counts
            const starClasses = ['one', 'two', 'three', 'four', 'five'];
            for (let i = 1; i <= 5; i++) {
                let bar = document.querySelector('.bar.' + starClasses[i-1] + '-star');
                let percentage = (data.star_counts[i] / data.total_count) * 100;
                bar.style.width = percentage + '%';

                // Update individual star counts
                document.getElementById('star-' + i + '-count').textContent = data.star_counts[i];
            }

            // Update total ratings
            document.querySelector('.total-ratings span').textContent = data.total_count + ' Ratings';
        });
};


    stars.forEach(star => {
        star.addEventListener('click', function () {
            const rating = this.getAttribute('data-value');
            ratingInput.value = rating; // Update hidden input value

            // Reset all stars to inactive state
            stars.forEach(s => s.classList.remove('active'));

            // Set this star and all previous stars to active
            this.classList.add('active');
            for (let i = 0; i < rating; i++) {
                stars[i].classList.add('active');
            }

            // Update the accuracy score based on new rating
            calculateAndDisplayAccuracyScore();
        });
    });

    // Initialize filter functionality
    const ratingSelect = document.getElementById('rating');
    ratingSelect.addEventListener('change', function() {
        filterReviews();
        calculateAndDisplayAccuracyScore();
    });

    subjectInput.addEventListener('change', function() {
        filterReviews();
        calculateAndDisplayAccuracyScore();
    });

    const reviewForm = document.querySelector('.add-review');
const reviewTextarea = document.querySelector('textarea[name="review_text"]');
const subjectSelect = document.getElementById('subject_list');

reviewForm.addEventListener('submit', function(event) {
    let isValid = true;
    const selectedRating = ratingInput.value;
    const selectedSubject = subjectSelect.value;
    const reviewText = reviewTextarea.value.trim();

    if (!selectedRating) {
        alert('Please select a rating.');
        isValid = false;
    }

    if (selectedSubject === 'choose') {
        alert('Please select a subject.');
        isValid = false;
    }

    if (!reviewText) {
        alert('Please enter your review.');
        isValid = false;
    }

    if (!isValid) {
        event.preventDefault(); // Prevent form submission if validation fails
    }
});
    // Calculate and display the initial accuracy score
    
    filterReviews();
    
});





function filterReviews() {
    const selectedRating = document.getElementById('rating').value;
    const selectedSubject = document.getElementById('subject').value;
    const reviews = document.querySelectorAll('.review');

    reviews.forEach(review => {
        const reviewRating = Number(review.getAttribute('data-rating'));
        const reviewSubject = String(review.getAttribute('data-subject'));
        const reviewText = review.querySelector('.review-text').textContent.trim(); // Get the review text and trim whitespace

        // Check if the review text is not empty in addition to existing conditions
        if ((selectedRating === "" || reviewRating === Number(selectedRating)) &&
            (selectedSubject === "" || reviewSubject === selectedSubject) &&
            reviewText !== "") { // Add this line
            review.style.display = '';
        } else {
            review.style.display = 'none';
        }
    });
}






    </script>
</body>
</html>