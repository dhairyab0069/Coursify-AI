<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Preview - Coursify.ai</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400;500&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="{{ url_for('static', filename='styleIndex.css') }}"
    />
    <style>
        #preview-container {
            width: 95%;
            height: calc(100vh - 250px);
            margin: 20px auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        #preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .preview-message {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
        .download-button {
            display: inline-block;
            padding: 12px 30px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: 500;
        }
        .download-button:hover {
            background: #45a049;
        }
        .content-header {
            text-align: center;
            padding: 20px;
        }
        #back-button {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        #back-button:hover {
            background: #0b7dda;
        }
        #loading {
            text-align: center;
            padding: 40px;
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body>
<header class="header">
    <div class="link_container">
        <a href="{{ url_for('index') }}">
            <img
                    src="{{ url_for('static', filename='cap_logo1.png') }}"
                    alt="Coursify Logo"
                    id="logo"
            />
        </a>
    </div>
    <nav class="navbar">
        <a href="{{ url_for('index') }}" id="homenav">HOME</a>
        <a href="{{ url_for('quiz_generate') }}" id="quiz">QUIZ</a>
        <a href="{{ url_for('my_content') }}" id="content">MY CONTENT</a>
        <a href="{{ url_for('ai_html') }}" id="ai">AI ASSISTANT</a>
        <a href="{{ url_for('reviews') }}" id="reviews">REVIEW</a>
        <a href="{{ url_for('settings') }}" id="settings">SETTINGS</a>
        <a href="{{ url_for('logout') }}" id="logout">LOGOUT</a>
    </nav>
    <i class="bx bx-menu"></i>
</header>

<div class="content-header">
    <h1 id="title">File Preview</h1>
    <button id="back-button">‚Üê Back to My Content</button>
</div>

<div id="loading" style="display: block;">Loading preview...</div>
<div id="preview-container" style="display: none;">
    <div id="preview-content"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Extract filename from URL path
        const pathParts = window.location.pathname.split('/');
        const filename = decodeURIComponent(pathParts[pathParts.length - 1]);
        const fileExtension = filename.split('.').pop().toLowerCase();
        const previewContent = document.getElementById('preview-content');
        const loadingDiv = document.getElementById('loading');
        const previewContainer = document.getElementById('preview-container');

        // Hide loading and show preview container
        setTimeout(() => {
            loadingDiv.style.display = 'none';
            previewContainer.style.display = 'block';
        }, 500);

        if (fileExtension === 'pdf') {
            // Use iframe for PDF preview - browser handles it natively
            const pdfUrl = `/pdf/${encodeURIComponent(filename)}`;
            previewContent.innerHTML = `<iframe id="preview-iframe" src="${pdfUrl}#toolbar=1&navpanes=1&scrollbar=1"></iframe>`;

        } else if (fileExtension === 'pptx') {
            // Use Microsoft Office Online Viewer for PPTX
            const pptxUrl = `/presentation/${encodeURIComponent(filename)}`;
            const fullUrl = window.location.origin + pptxUrl;
            const viewerUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(fullUrl)}`;
            previewContent.innerHTML = `<iframe id="preview-iframe" src="${viewerUrl}"></iframe>`;

        } else if (fileExtension === 'docx') {
            // DOCX cannot be previewed - show download option
            previewContent.innerHTML = `
    <div class="preview-message">
      <h2>üìÑ Document Preview</h2>
      <p><strong>${filename}</strong></p>
      <p>Word documents cannot be previewed directly in the browser.</p>
      <p>Click the button below to download and open in Microsoft Word or Google Docs.</p>
      <button onclick="window.history.back()" class="download-button">‚Üê Back to My Content</button>
    </div>
  `;
        }else if (fileExtension === 'pptx') {
            // PPTX cannot be previewed - show download option
            previewContent.innerHTML = `
    <div class="preview-message">
      <h2>üìä Presentation Preview</h2>
      <p><strong>${filename}</strong></p>
      <p>PowerPoint files cannot be previewed directly in the browser.</p>
      <p>Click the button below to download and open in PowerPoint or Google Slides.</p>
      <button onclick="window.history.back()" class="download-button">‚Üê Back to My Content</button>
    </div>
  `;
        }else {
            previewContent.innerHTML = `
            <div class="preview-message">
              <h2>Preview Not Available</h2>
              <p>This file type (${fileExtension}) cannot be previewed in the browser.</p>
              <a href="{{ url_for('my_content') }}" class="download-button">‚Üê Back to My Content</a>
            </div>
          `;
        }
    });

    // Back button functionality
    document.getElementById("back-button").addEventListener("click", function () {
        window.location.href = "{{ url_for('my_content') }}";
    });
</script>

<footer id="footer">&copy; 2023 CoursifyAI. All rights reserved.</footer>
</body>
</html>